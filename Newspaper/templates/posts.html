{% extends 'flatpages/default.html' %}
{% load custom_filters %}
{% load custom_tags %}

{% block title %}
Posts
{% endblock title %}

{% block content %}
   <h1>Все новости</h1>
   <form action="" method="get">
       {# Переменная, которую мы передали через контекст, может сгенерировать нам форму с полями #}
       {{ filterset.form.as_p }}
       {# Добавим кнопку отправки данных формы #}
       <input type="submit" value="Найти" />
   </form>
   <h2>{{ posts|length }}</h2>
   <h3>{{ time_now|date:'M d Y' }}</h3>
   <h3>{{ new_post|default_if_none:"Мы сообщим о свежих новостях" }}</h3>
   <hr>
   {% if posts %}
       <table>
           <tr>
               <td>Автор</td>
               <td>Время написания</td>
               <td>Категория</td>
               <td>Заголовок</td>
               <td>Текст</td>
               <td>Рейтинг</td>
           </tr>
           {% for post in posts %}
           <tr>
               <td>{{ author.User.username }}</td>
               <td>{{ post.time_in }}</td>
                {% for category in post.category.all %}
              <td> {{ category.name_category }}</td>
                  {% endfor %}
               <td>{{ post.head_name }}</td>
               <td>{{ post.article_text|truncatewords:2 }}</td>
               <td>{{ post.rate }}</td>
           </tr>
           {% endfor %}

       </table>
   {% else %}
       <h2>Почитать - то и нечего...</h2>
   {% endif %}
{% if is_paginated %}

        {% if page_obj.has_previous %}
            <a href="?page=1{{ request.get_full_path|is_filters_uses }}">&laquo; First</a>
            <a href="?page={{ page_obj.previous_page_number }}{{ request.get_full_path|is_filters_uses }}"><<<</a>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
                <a>{{ num }}</a>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <a href="?page={{ num }}{{ request.get_full_path|is_filters_uses }}">{{ num }}</a>
            {% endif %}
        {% endfor %}

        <!-- Если есть следующая страница, то даём ссылку на неё и на самую последнюю страницу -->
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{{ request.get_full_path|is_filters_uses }}">>>></a>
            <a href="?page={{ page_obj.paginator.num_pages }}{{ request.get_full_path|is_filters_uses }}">Last &raquo;</a>
        {% endif %}

    {% endif %}
{% endblock content %}